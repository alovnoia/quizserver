'use strict';

var mongoose = require('mongoose'),
Topic = mongoose.model('Topics'),
Question = mongoose.model('Questions'),
Package = mongoose.model('Packages');
var imageHelper = require('../helper/imageHelper');

exports.list_all_topics = function(req, res) {
  //imageHelper.base64_decode('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WHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIgogICAgICAgICAgICB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyI+CiAgICAgICAgIDx4bXA6TW9kaWZ5RGF0ZT4yMDEzLTA4LTI4VDEzOjU5OjQ5PC94bXA6TW9kaWZ5RGF0ZT4KICAgICAgICAgPHhtcDpDcmVhdG9yVG9vbD5BZG9iZSBQaG90b3Nob3AgQ1M2IChXaW5kb3dzKTwveG1wOkNyZWF0b3JUb29sPgogICAgICAgICA8eG1wOkNyZWF0ZURhdGU+MjAxMy0wOC0yOFQxMzo1NjowMDwveG1wOkNyZWF0ZURhdGU+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgICAgIDx0aWZmOllSZXNvbHV0aW9uPjcyPC90aWZmOllSZXNvbHV0aW9uPgogICAgICAgICA8dGlmZjpSZXNvbHV0aW9uVW5pdD4yPC90aWZmOlJlc29sdXRpb25Vbml0PgogICAgICAgICA8dGlmZjpYUmVzb2x1dGlvbj43MjwvdGlmZjpYUmVzb2x1dGlvbj4KICAgICAgICAgPGV4aWY6Q29sb3JTcGFjZT4xPC9leGlmOkNvbG9yU3BhY2U+CiAgICAgICAgIDxleGlmOlBpeGVsWERpbWVuc2lvbj40NTwvZXhpZjpQaXhlbFhEaW1lbnNpb24+CiAgICAgICAgIDxleGlmOlBpeGVsWURpbWVuc2lvbj42MTwvZXhpZjpQaXhl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', 'test.png');
  //imageHelper.base64_encode('csa.png');
  Topic.find({deleted: false}, function(err, topic) {
    if (err)
      res.send(err);
    res.json(topic);
  });
};

exports.create_a_topic = function(req, res) {
  var new_topic = new Topic(req.body);
  new_topic.save(function(err, topic) {
    if (err)
      res.send(err);
    res.json(topic);
  });
};

exports.read_a_topic = function(req, res) {
  Topic.findById(req.params.topicId, function(err, topic) {
    if (err)
      res.send(err);
    res.json(topic);
  });
};

exports.update_a_topic = function(req, res) {
  Topic.findOneAndUpdate({_id: req.params.topicId}, req.body, {new: true}, function(err, topic) {
    if (err)
      res.send(err);
    res.json(topic);
  });
};

exports.delete_a_topic = function(req, res) {
  //console.log(req.params.topicId);
  //Question.updateMany({}, {$pull: {topic: {_id: req.params.topicId}}}, {new: true}, function(err, result){});
  Topic.findOneAndUpdate({_id: req.params.topicId}, {deleted: true}, {new: true}, function(err, topic) {
    if (err) {
      res.send(err);
    } else {
      Question.updateMany({}, {$pull: {topic: {'_id': req.params.topicId}}}, {new: true}, function(err, result){});
      Package.updateMany({'topic.id': req.params.topicId}, {$set: {topic: {}, deleted: true}}, {new: true}, function(err, result){});    
      res.json(topic);
    }
  });
/*  Topic.remove({
    _id: req.params.topicId
  }, function(err, topic) {
    if (err)
      res.send(err);
    res.json({ message: 'Topic successfully deleted' });
  });*/
};